<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Loopringäº¤æ˜“æ‰€circuitåˆ†æ - Czm blog</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Czm" />
  <meta name="description" content="Loopringäº¤æ˜“æ‰€circuitåˆ†æï¼Œloopringæ˜¯ä»¥å¤ªåŠä¸ŠåŸºäºzkrollupçš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œèƒ½å¤Ÿä¿è¯äº¤æ˜“æ‰€ä½œæ¶ä½†ä¸èƒ½è·ç›Šã€‚å…¶é›¶çŸ¥è¯†éƒ¨åˆ†åŸºäºlibsnarkå’Œethsnark" />







<meta name="generator" content="Hugo 0.67.0" />


<link rel="canonical" href="https://puppym.github.io/blog/post/loopring%E4%BA%A4%E6%98%93%E6%89%80circuit%E5%88%86%E6%9E%90/loopring%E4%BA%A4%E6%98%93%E6%89%80circuit%E5%88%86%E6%9E%90/" />





<link rel="icon" href="/blog/favicon.ico" />











<link rel="stylesheet" href="/blog/sass/jane.min.fa3d941d1d0e0ddc985804227feabffea55c89883eb0af34e0532a7ae9135151.css" integrity="sha256-&#43;j2UHR0ODdyYWAQif&#43;q//qVciYg&#43;sK804FMqeukTUVE=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Loopringäº¤æ˜“æ‰€circuitåˆ†æ" />
<meta property="og:description" content="Loopringäº¤æ˜“æ‰€circuitåˆ†æï¼Œloopringæ˜¯ä»¥å¤ªåŠä¸ŠåŸºäºzkrollupçš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œèƒ½å¤Ÿä¿è¯äº¤æ˜“æ‰€ä½œæ¶ä½†ä¸èƒ½è·ç›Šã€‚å…¶é›¶çŸ¥è¯†éƒ¨åˆ†åŸºäºlibsnarkå’Œethsnark" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://puppym.github.io/blog/post/loopring%E4%BA%A4%E6%98%93%E6%89%80circuit%E5%88%86%E6%9E%90/loopring%E4%BA%A4%E6%98%93%E6%89%80circuit%E5%88%86%E6%9E%90/" />
<meta property="article:published_time" content="2020-04-06T10:52:22+08:00" />
<meta property="article:modified_time" content="2020-04-06T10:52:22+08:00" />
<meta itemprop="name" content="Loopringäº¤æ˜“æ‰€circuitåˆ†æ">
<meta itemprop="description" content="Loopringäº¤æ˜“æ‰€circuitåˆ†æï¼Œloopringæ˜¯ä»¥å¤ªåŠä¸ŠåŸºäºzkrollupçš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œèƒ½å¤Ÿä¿è¯äº¤æ˜“æ‰€ä½œæ¶ä½†ä¸èƒ½è·ç›Šã€‚å…¶é›¶çŸ¥è¯†éƒ¨åˆ†åŸºäºlibsnarkå’Œethsnark">
<meta itemprop="datePublished" content="2020-04-06T10:52:22&#43;08:00" />
<meta itemprop="dateModified" content="2020-04-06T10:52:22&#43;08:00" />
<meta itemprop="wordCount" content="6137">



<meta itemprop="keywords" content="loopring,zkrollup,zksnark," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Loopringäº¤æ˜“æ‰€circuitåˆ†æ"/>
<meta name="twitter:description" content="Loopringäº¤æ˜“æ‰€circuitåˆ†æï¼Œloopringæ˜¯ä»¥å¤ªåŠä¸ŠåŸºäºzkrollupçš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œèƒ½å¤Ÿä¿è¯äº¤æ˜“æ‰€ä½œæ¶ä½†ä¸èƒ½è·ç›Šã€‚å…¶é›¶çŸ¥è¯†éƒ¨åˆ†åŸºäºlibsnarkå’Œethsnark"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/blog/" class="logo">Czm blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://puppym.github.io/blog/">This is Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://puppym.github.io/blog/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://puppym.github.io/blog/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://puppym.github.io/blog/categories/">Categories</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/blog/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/blog/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/blog/" class="logo">
    
      Czm blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://puppym.github.io/blog/">This is Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://puppym.github.io/blog/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://puppym.github.io/blog/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://puppym.github.io/blog/categories/">Categories</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Loopringäº¤æ˜“æ‰€circuitåˆ†æ</h1>
      
      <div class="post-meta">
        <time datetime="2020-04-06" class="post-time">
          2020-04-06
        </time>
        
        <span class="more-meta"> 6137 words </span>
          <span class="more-meta"> 13 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#ç”µè·¯åˆ—è¡¨">ç”µè·¯åˆ—è¡¨</a></li>
        <li><a href="#æ³¨æ„ç‚¹">æ³¨æ„ç‚¹</a></li>
        <li><a href="#å¯èƒ½é—®é¢˜">å¯èƒ½é—®é¢˜</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h3 id="ç”µè·¯åˆ—è¡¨">ç”µè·¯åˆ—è¡¨</h3>
<ol>
<li>Ring Settlement(ç¯ç»“ç®—)ï¼šä¸»è¦æ˜¯é€šè¿‡æ’®åˆä¸¤ç§ä¸åŒä»£å¸çš„å®Œæˆå„ç§<code>token</code>ä¹‹é—´çš„ç›¸äº’è½¬åŒ–ã€‚ç¯ç»“ç®—çš„åè®®è´¹å’Œæ“ä½œè´¹åªèƒ½ç”¨å•ä¸€çš„å¸ç§è¿›è¡Œç»“ç®—ã€‚</li>
<li>Depositï¼šä¸»è¦æ˜¯ç”¨æˆ·å‘é“¾ä¸Šå­˜å‚¨<code>token</code>ï¼Œå¹¶ä¸”æ”¹å˜é“¾ä¸Šçš„<code>merkleroot</code>çš„çŠ¶æ€  ã€‚<code>updateBalanceGadget</code>å’Œ<code>updateAccountGadget</code>ä¸€èˆ¬æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ç§æ˜¯æ ¡éªŒå½“å‰è®¡ç®—çš„<code>merkleroot</code>æ˜¯å¦å’Œä¿å­˜çš„<code>merkleroot</code>ç›¸äº’åŒ¹é…ã€‚ä¸€ç§æ˜¯è®¡ç®—æ›´æ–°ä¹‹åæ–°çš„<code>merkleroot</code>çš„å€¼ï¼Œå¹¶ä¸”è¿›è¡Œä¿å­˜ã€‚</li>
<li>off-chain withdraw: ä¼˜ç‚¹æ˜¯æ¯”è¾ƒå¿«ï¼Œç›´æ¥å‘åˆ°ä¸­ç»§è¿›è¡Œå¤„ç†ï¼Œç¼ºç‚¹æ˜¯ä¸­ç»§å¯ä»¥é€‰æ‹©æ€§ä¸å¤„ç†ã€‚è¿™ä¸ªæ“ä½œéœ€è¦æ”¯ä»˜äº¤æ˜“è´¹ç”¨ï¼Œå¹¶ä¸”äº¤æ˜“è´¹ç”¨å¯ä»¥ä½¿ç”¨å’Œäº¤æ˜“å¸ç§ä¸åŒçš„tokenã€‚</li>
<li>on-chain withdraw: æœ‰å…³é—­æ¨¡å¼ï¼Œå½“<code>bshutdownMode</code>æ¨¡å¼å¼€å¯åè¿›å…¥äº¤æ˜“æ‰€å…³é—­æ¨¡å¼ï¼Œæ‰€æœ‰çš„<code>on-chain</code>è¯·æ±‚éƒ½ä¼šè¢«ç¦æ­¢ï¼Œæœªå¤„ç†å®Œçš„<code>on-chain deposit</code>è¯·æ±‚ä¼šç»§ç»­è¢«å¤„ç†ã€‚åªæœ‰ç‰¹æ®Šçš„<code>on-chain withdraw</code>è¯·æ±‚ä¼šè¢«commitï¼Œè¿™äº›è¯·æ±‚ä¼šé‡ç½®merkletreeä¸Šçš„ç›¸åº”å†…å®¹ï¼Œå½“æ•´ä¸ªmerkletreeæ¢å¤åˆ°æœ€åˆçŠ¶æ€ï¼Œäº¤æ˜“æ‰€èƒ½å¤Ÿæ‹¿å‡ºå®ƒæŠµæŠ¼çš„é‡‘é¢ã€‚</li>
<li>Order Cancellationï¼šå–æ¶ˆå½“å‰è¦æ’®åˆçš„è®¢å•ã€‚</li>
</ol>
<h3 id="æ³¨æ„ç‚¹">æ³¨æ„ç‚¹</h3>
<ol>
<li>pb_variable ç±»å‹ä¸­çš„<code>pb_variable</code>æ˜¯<code>unsigned long</code>ç±»å‹çš„å˜é‡ã€‚</li>
<li>æ¯ä¸ªç”µè·¯çš„<code>generate_r1cs_constraints</code>å‡½æ•°ä¸­ä¼šå­˜åœ¨numå˜é‡ï¼Œ<strong>è¿™ä¸ªå€¼æ˜¯å›ºåŒ–åœ¨ç”µè·¯ä¸­çš„ï¼Ÿ</strong>ï¼Œä¸»è¦æ˜¯ç”¨æ¥è®°å½•ä¸€ä¸ªblockä¸­å«æœ‰å¤šå°‘ä¸ªè¯¥ç±»çš„äº¤æ˜“ã€‚</li>
<li><code>label</code>ä¸»è¦æ˜¯ç”¨æ¥ä¿å­˜ä¸€äº›äº¤æ˜“ä¿¡æ¯ï¼Œæ˜¯å°†ä¸€äº›å¤æ‚çš„åŠŸèƒ½ç®€åŒ–ï¼Œæ¯”å¦‚åœ¨<code>deposit</code>ç”µè·¯ä¸­<code>label</code>å¯ä»¥ç”¨æ¥è¡¨ç¤ºè¿™ä¸ªè®¢å•æ˜¯ä»å“ªä¸ªé’±åŒ…æ¥çš„å•å­ï¼Œåœ¨<code>offchainwithdraw</code>ä¸­<code>operator</code>éœ€è¦æ”¶å–ä¸€å®šçš„æ‰‹ç»­è´¹ï¼Œ<code>label</code>å¯ä»¥ç”¨æ¥æ ‡è®°operatoråç»­æ‰‹ç»­è´¹çš„å…·ä½“åˆ†é…ï¼Œå› ä¸ºåœ¨é“¾ä¸Šå­˜å‚¨äº†æ¯ä¸€ä¸ªblockçš„<code>labelhash</code>ï¼Œ<code>label</code>çš„å†…å®¹å°±ä¸èƒ½è¢«æ›´æ”¹ã€‚å› æ­¤ä¹Ÿæ˜¯ä¸€ç§ä½¿ç”¨ç®€å•çš„æ–¹æ³•å°†å„ç§å¤æ‚é—®é¢˜ä¸€èµ·å¤„ç†ã€‚</li>
<li><code>DualVariableGadget</code>ç»„ä»¶å¹¶ä¸ç®€å•ï¼Œå› ä¸ºå„ä¸ª<code>gadget</code>æ˜¯é€šè¿‡<code>generate_r1cs_witness</code>å‡½æ•°æ¥è¿›è¡Œä¼ å…¥è¾“å…¥å€¼â€”â€”ç›¸å½“äºä¸€äº›<code>gadget</code>çš„è§è¯ï¼Œé€šè¿‡<code>generate_r1cs_constraints</code>æ¥è¿›è¡Œç”µè·¯çº¦æŸï¼Œä½†æ˜¯åœ¨é€»è¾‘ä¸Šåè€…æ˜¯åœ¨å‰è€…ä¹‹å‰è¢«æ‰§è¡Œï¼Œä½†æ˜¯åœ¨<code>constraints</code>ä¸­æ·»åŠ çº¦æŸçš„å˜é‡å€¼åˆæ˜¯åœ¨<code>witness</code>å‡½æ•°ä¸­è¿›è¡Œä¼ å…¥çš„â€”â€”è¿™é‡Œæ˜¯å› ä¸º<code>constraints</code>é‡Œé¢ä»…ä»…æ˜¯å¯¹äºç”µè·¯çš„é€»è¾‘çº¦æŸï¼Œå…·ä½“çš„å€¼çš„æ ¡éªŒè¦åœ¨<code>witness</code>å‡½æ•°æ‰§è¡Œä¹‹åå†è¿›è¡Œã€‚å¦‚æœå‰è€…çš„<code>witness</code>è¿‡ç¨‹å‡ºç°é”™è¯¯ï¼Œåº”è¯¥è¿”å›<code>false</code>ã€‚</li>
<li><code>onchainwithdrawal</code>ç”µè·¯å’Œ<code>deposit</code>ç”µè·¯å› ä¸ºæ˜¯on-chainæ“ä½œï¼Œåœ¨ethä¸­ç”Ÿæˆçš„äº¤æ˜“ä¸­å«æœ‰nonceï¼Œå› æ­¤Accountä¸­çš„<code>nonce</code>éšæœºæ•°å€¼ä¸ä¼šè¿›è¡ŒåŠ 1ã€‚</li>
<li>æ³¨æ„æ¯æ¡ç”µè·¯ä¸­çš„<code>publicData</code>å€¼æ˜¯æ¯æ¡ç”µè·¯çš„è¾“å…¥å€¼å’Œè¾“å‡ºå€¼ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”è®¡ç®—ç»“æœhashï¼Œå¹¶ä¸”æ ¡éªŒä¸¤è€…hashæ˜¯å¦ç›¸åŒã€‚æ³¨æ„hashç»“æœçš„å€¼æ˜¯åœ¨<code>constraints</code>é‡Œé¢è¿›è¡Œè®¡ç®—çš„ã€‚</li>
<li><code>/blocks</code>ä¸‹é¢jsonæ–‡ä»¶æ ¼å¼ä¸º<code>&quot;./blocks/block_&quot; + exchangeID + &quot;_&quot; + nextBlockIdx + &quot;_info.json&quot;</code>ï¼Œ<code>/states</code>ä¸‹é¢çš„jsonæ–‡ä»¶æ ¼å¼ä¸º<code>&quot;./states/state_&quot; + str(exchangeID) + &quot;_&quot; + str(previousBlockIdx) + &quot;.json&quot;</code>ï¼Œ<code>exchangeID</code>ä¸ºäº¤æ˜“æ‰€IDï¼Œåé¢æ˜¯å—çš„IDã€‚</li>
<li>å…³äºç±»å‹<code>pb.val(VariableT) = Field</code></li>
<li>ä½¿ç”¨çš„æ•°å­—ç­¾åå‡½æ•°å’Œhashå‡½æ•°æœ‰åˆ›æ–°ï¼Œä½¿ç”¨çš„hashå‡½æ•°æ˜¯<code>poseidon</code>å“ˆå¸Œå‡½æ•°ï¼Œå…¶ä½¿ç”¨çš„æ›²çº¿æ˜¯<code>jubjub</code>æ›²çº¿ï¼Œé€šè¿‡åšå®¢è¯´æ˜¯æœ‰è¾ƒå¥½çš„æ€§èƒ½ã€‚ä½¿ç”¨çš„æ•°å­—ç­¾åå‡½æ•°æ˜¯åŸºäº<code>poseidon</code>å“ˆå¸Œå‡½æ•°çš„EdDSAæ•°å­—ç­¾åå‡½æ•°ã€‚</li>
<li><code>protocolFeeBips</code>åœ¨<code>ringsettlementblock</code>ï¼Œè¿™ä¸ªå€¼éšç€æŠµæŠ¼é‡‘é¢çš„å¢åŠ è´¹ç”¨é€æ¸é™ä½ã€‚<code>protocolFee  = amountB * protocolFeeBips / 100000</code>ï¼Œè¿™ä¸ªè´¹ç”¨æ˜¯operatorç»™<code>protocol Account</code>ã€‚fee å’Œ rebate åœ¨ order ä¸­ã€‚<code>fee = amountB * feeBips / 10000</code>ã€‚<code>rebate = amount * rebateBips / 10000</code>ã€‚feeæ˜¯ç”¨æˆ·æ”¯ä»˜ç»™operatorï¼Œrebateæ˜¯operatoræ”¯ä»˜ç»™(é’±åŒ…ç”¨æˆ·)ç”¨æˆ·çš„å›æ‰£ã€‚</li>
<li>bshutdownæ¨¡å¼ä¸ºäº¤æ˜“æ‰€å…³é—¨æ¨¡å¼ï¼Œäº¤æ˜“æ‰€ä¼šç»§ç»­å¤„ç†ç”¨æˆ·çš„OnchainWithdrawï¼Œå³countä¸ä¸º0ï¼Œç„¶åwithdrawsé‡Œé¢çš„æ•°æ®æ˜¯ç”¨æˆ·æäº¤è¦å¤„ç†çš„å‡ºå±€ã€‚Operatorä¹Ÿå¯ä»¥è‡ªå·±å¡«å……å•å­ï¼Œå…·ä½“çš„åšæ³•æ˜¯å°†countç½®ä¸º0ï¼Œç„¶åè‡ªå·±å¡«å……withdrawsï¼Œoperatorè‡ªå·±ç”Ÿæˆè¯æ˜å°†ç”¨æˆ·çš„tokené€€è¿˜ç»™ç”¨æˆ·ã€‚</li>
<li>å½“äº¤æ˜“æ‰€è·‘è·¯åï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨<code>dataavailable</code>æ¨¡å¼è·å–é“¾ä¸Šæ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åé€šè¿‡<code>dataavailable</code>çš„æ•°æ®è¯æ˜è‡ªå·±æœ‰ä¸€äº›ä½™é¢ï¼Œé“¾ä¸Šåˆçº¦ä¼šè¿”å›ç”¨æˆ·çš„tokenï¼Œé“¾ä¸Šçš„merklerootå’Œcalldataï¼Œä¿è¯äº†æ•°æ®é“¾ä¸‹æ•°æ®ä¸è¢«ç¯¡æ”¹ã€‚calldataä¿è¯äº†æ ¹æ®é“¾ä¸Šæ•°æ®ä¸€æ­¥ä¸€æ­¥ç®—çš„æ—¶å€™æ¯ä¸€æ­¥è¾“å…¥çš„æ­£ç¡®æ€§ï¼Œæœ€åç»“æœä¼šç”Ÿæˆä¸€ä¸ªmerkletreeã€‚é€šè¿‡éªŒè¯æœ¬åœ°çš„merklerootå’Œé“¾ä¸Šmerklerootæ˜¯å¦ç›¸åŒï¼Œä»è€Œè¯æ˜æœ¬åœ°è®¡ç®—æ•°æ®çš„æ­£ç¡®æ€§å’ŒçœŸå®æ€§ã€‚</li>
<li>äº¤æ˜“æ‰€å¯¹äºæ˜¯å¦å¼€å¯<code>onChainDataAvailable</code>æœ‰ä¸¤ç§ç©æ³•ï¼Œä¸€ç§æ˜¯å¼€å¯<code>onChainDataAvailable</code>ï¼Œç”¨æˆ·å¯ä»¥ç›‘ç®¡å’Œäº¤æ˜“æ‰€è·‘è·¯ï¼Œç”¨æˆ·å¯ä»¥è¯æ˜è‡ªå·±æœ‰è¿™ä¹ˆå¤šé’±ã€‚ä¸€ç§ä¸å¼€å¯ï¼Œè™½ç„¶ååé‡é«˜ï¼Œä½†æ˜¯ç”¨æˆ·éœ€è¦æ‰¿æ‹…äº¤æ˜“æ‰€è·‘è·¯å¹¶ä¸”é”€æ¯æ•°æ®ï¼Œç”¨æˆ·å°±ä¸èƒ½è¯æ˜è‡ªå·±æœ‰é‚£ä¹ˆå¤šé’±ã€‚</li>
<li>å¯¹äºon-chainçš„<code>deposit</code>å’Œ<code>onchainWithdraw</code>ä¸¤ä¸ªæ“ä½œè®¡ç®—æ¯ä¸ªå­æ“ä½œè®¡ç®—publicDataçš„hashçš„æ—¶å€™æ˜¯è®¡ç®—<code>accumulated hash</code>ã€‚</li>
<li>merkletreeå½“ä¸­çš„accountä¸‹æœ‰nonceå˜é‡ï¼Œè¯¥å˜é‡é˜²æ­¢é‡å‘off-chainæ“ä½œï¼Œå› æ­¤æ¯ä¸€æ¬¡off-chainæ“ä½œéƒ½åº”è¯¥ä½¿å¾—nonceçš„å€¼åŠ 1ã€‚å°†è¯¥nonceåŒ…å«è¿›ç”¨æˆ·offchainWithdrawå’ŒorderCancellationï¼Œoperatorçš„RingSettlementçš„ç­¾åä¸­ï¼Œé˜²æ­¢off-chainæ“ä½œè¢«é‡æ”¾ã€‚å¯¹äºbshutdownçš„OnchainWithdrawæ“ä½œï¼Œaccountçš„nonceå€¼è¦è¢«å›æ‰§ä¸º0ã€‚</li>
<li>åœ¨æ¯æ¡ç”µè·¯è¿è¡Œè¿‡ç¨‹ä¸­çš„hash(publicData)çš„å‰23ä½ï¼Œå°±æ˜¯ç”Ÿæˆè¯æ˜ä¸­çš„inputçš„å€¼ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å›ºå®šç”µè·¯çš„è¾“å…¥å€¼ï¼Œå½“é“¾ä¸Šä½¿ç”¨ç”Ÿæˆçš„prooféªŒè¯æ—¶é€šè¿‡è¯¥å€¼å¯ä»¥ç¡®ä¿ç”µè·¯çš„è¾“å…¥æ˜¯é“¾ä¸Šçš„è¾“å…¥ã€‚</li>
<li>å¯¹äºé“¾ä¸Šå­˜å‚¨çš„<code>depositBlockHashStart</code>æ˜¯ä¸€ä¸ªbigintç±»å‹ï¼Œè¯¥ç±»å‹ç›¸å½“äºæ˜¯å°ç«¯æ­£å¸¸hashå€¼çš„å¤§ç«¯å­˜å‚¨ã€‚å› æ­¤åœ¨bigintè½¬æ¢æˆ<code>DualVariableGadget</code>çš„è¿‡ç¨‹ä¸­ä¼šå°†bigintè½¬åŒ–æˆå°ç«¯å­˜å‚¨çš„hashå€¼ã€‚<strong>å› æ­¤é“¾ä¸Šéƒ½æ˜¯å­˜å‚¨çš„åå‘çš„hashå€¼ï¼Œå› æ­¤æ¯æ¬¡å¯¼å‡ºå—å°±æ˜¯åå‘hashå€¼çš„</strong>ã€‚å¯¹äºå¤§ç«¯å’Œå°ç«¯çš„ç†è§£ï¼šå­˜å‚¨æ–¹å¼ä¸ä¸€æ ·ï¼Œå°ç«¯æ•°æ®ç¿»è½¬åä¼ è¾“åˆ°å¤§ç«¯ä¸Šä¸¤è€…çš„å€¼æ˜¯ç›¸åŒçš„ã€‚</li>
<li>å¯¹äºDualVariableGadgetç›¸å½“äºæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œé‡Œé¢çš„packedç›¸å½“äºå€¼ï¼Œbitsç›¸å½“äºè¿™ä¸ªgadgetsæ‰€å çš„ä½æ•°ã€‚</li>
<li>onchainæ“ä½œé€šè¿‡accumlatehashå€¼æ¥ç¡®ä¿ç”¨æ¥proveçš„å€¼ä¸è¢«æ›´æ”¹ã€‚é¦–å…ˆç”¨æˆ·æäº¤æ•°æ®åˆ°ethï¼Œåœ¨ethé“¾ä¸Šç®—accumlatehashï¼Œoperatoræ‰“åŒ…blockå»ç”Ÿæˆè¯æ˜ã€‚publicDataä¸­çš„accumlatehashå¯ä»¥å’Œé“¾ä¸Šè®¡ç®—çš„accumlatehashç›¸äº’æ¯”è¾ƒï¼Œç¡®ä¿proveçš„è¾“å…¥çš„æ•°æ®æ­£ç¡®ã€‚å¦‚æœoperatorè¾“å…¥proveçš„æ•°æ®æ­£ç¡®ï¼Œä½†æ˜¯ä¸Šé“¾çš„publicDataè¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆé“¾ä¸Šä½¿ç”¨publicDataè®¡ç®—publicInputï¼Œç„¶åç”¨è¯¥å€¼verifiyçš„æ—¶å€™ä¼šé”™è¯¯ã€‚</li>
<li>åœ¨é“¾ä¸‹ä¿å­˜merkletreeçš„çŠ¶æ€ï¼Œmerkletreeçš„çŠ¶æ€æ¯æ¬¡åœ¨é“¾ä¸‹æ›´æ–°åªä¼šè®¡ç®—ä¸€éï¼Œåœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­ç›¸åº”çš„ç¨‹åºä¼šç”Ÿæˆblock.jsonï¼Œè¯¥jsonæ–‡ä»¶åŒ…å«merkletreeçŠ¶æ€æ›´æ–°çš„ä¸€äº›ä¸­é—´è¿‡ç¨‹ã€‚ç„¶åè¯¥jsonæ–‡ä»¶ä¼šè¾“å…¥åˆ°proveä¸­ç”Ÿæˆè¯æ˜ï¼Œå¦‚æœoperatorä½œæ¶ï¼Œé‚£ä¹ˆè¯æ˜çš„ç”Ÿæˆä¼šé”™è¯¯ã€‚ç›¸å½“äºæ•´ä½“ä¸Šè®¡ç®—äº†ä¸¤éï¼Œä¸­ç»§ä¸€è¾¹ï¼Œç”µè·¯ä¼šè®¡ç®—ä¸€è¾¹ä½¿ç”¨å‰ä¸€éæ‰§è¡Œçš„ä¸­é—´ç»“æœè®¡ç®—ä¸€è¾¹ç„¶åè¿›è¡ŒéªŒè¯ã€‚</li>
<li>æ•°æ®ä¸€è‡´æ€§ä¿è¯ï¼š</li>
</ol>
<ul>
<li>operatorä¸èƒ½æ›´æ”¹ç”¨æˆ·çš„æ•°æ®ï¼Œç”¨æˆ·å¯¹åº”çŠ¶æ€æ ‘ä¸­çš„ç§é’¥ç­¾åä¿è¯ã€‚</li>
<li>operatorä¸èƒ½ç›´æ¥æ”¹merkletreeä¸Šçš„çŠ¶æ€ï¼Œmerklerootbeforeå’Œmerklerootafterä¿è¯ã€‚</li>
<li>operatorä¸èƒ½æ”¹é“¾ä¸‹è®¡ç®—çŠ¶æ€æ ‘åçš„æ•°æ®ï¼Œblock.jsonæ˜¯block_info.jsonç»è¿‡é“¾ä¸‹ç¨‹åºè®¡ç®—å¾—åˆ°ã€‚block.jsonæ˜¯ç”¨æ¥ç”Ÿæˆè¯æ˜çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯block_info.jsonç¨‹åºåœ¨è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸€äº›ä¸­é—´è¿‡ç¨‹ä¿å­˜åœ¨block.jsonä¸­ã€‚æ”¹block_info.jsonï¼Œå¯¹äºOnchainè¡Œä¸ºï¼Œä½¿ç”¨accumulateHashè¿›è¡Œæ ¡éªŒï¼Œå¯¹äºoffchainè¡Œä¸ºï¼Œä½¿ç”¨loopringçš„å…¬é’¥éªŒè¯æ•°å­—ç­¾åä¼šè¿›è¡Œæ ¡éªŒã€‚æ”¹block.jsonä¸­çš„æ•°æ®ï¼Œç”Ÿæˆè¯æ˜ä¼šå¤±è´¥ã€‚</li>
</ul>
<ol start="22">
<li>merkletreeä½¿ç”¨ç¨€ç–merkletreeã€‚</li>
<li>signatureåˆ†æï¼Œä¸€å…±ä½¿ç”¨äº†ä¸¤ç§å…¬ç§å¯†é’¥ï¼Œethå…¬ç§é’¥ï¼Œloopringå…¬ç§é’¥ã€‚</li>
<li>orderå–æ¶ˆåcancellä¼šè¢«å˜ä¸º1ï¼Œåœ¨ringsettlementçš„æ—¶å€™MatchingGadgetå°†fillä¸º0ï¼Œåœ¨orderMatchingæ£€æŸ¥è®¢å•CheckValidGadgetï¼Œä¼šåœ¨è¿™é‡Œæ£€æŸ¥å‡ºfillä¸º0ã€‚isNonZeroFillAmountSã€‚</li>
<li><strong>publicDatahashåœ¨ç”µè·¯ä¸­è®¡ç®—ä¸€æ¬¡ç¡®ä¿äº†ä½ åœ¨ç”µè·¯ä¸­è®¡ç®—æ‰€ç”¨çš„è¾“å…¥æ˜¯å’Œä½ commitåˆ°é“¾ä¸Šçš„blockç›¸åŒã€‚ç„¶åå­˜åœ¨ä¸€ç§æƒ…å†µå°±æ˜¯commitåˆ°é“¾ä¸Šçš„blockå’Œè¾“å…¥åˆ°ç”µè·¯ä¸­é¢å€¼éƒ½è¢«ä¸­ç»§æ”¹äº†ï¼Œå…¶å®æœ‰ä¸¤ç§æ–¹å¼æ ¡éªŒï¼Œç¬¬ä¸€å¯¹åº”offchainçš„æ“ä½œï¼Œç”¨æˆ·ä¼šç”¨loopringçš„ç§é’¥ç»™å…¶ç­¾åã€‚å¯¹äºonchainæ“ä½œï¼ˆåœ¨é“¾ä¸‹è®¡ç®—å¼€å§‹æ—¶æ”¹æ•°æ®ï¼Œä»¥å¤ªåŠå…¬é’¥å¯¹è®¢å•éªŒç­¾ä¸ä¼šé€šè¿‡ï¼‰ã€‚2. é€šè¿‡merklerootæ ¡éªŒï¼Œä¸€ä¸ªè´¦æˆ·æ˜¯5ï¼Œä½ æ”¹æˆ10ï¼Œæ˜æ˜¾merklerootçš„æ ¡éªŒä¸ä¼šé€šè¿‡ã€‚ï¼ˆè®¡ç®—å®Œä¹‹åæ”¹æ•°æ®ï¼ŒmerkleRootæ ¡éªŒä¸ä¼šé€šè¿‡ï¼‰</strong></li>
</ol>
<p><strong>ç”¨æˆ·ä½¿ç”¨loopringç§é’¥ç­¾åçš„åœºæ™¯</strong>ï¼Œä¸‹é¢éƒ½æ˜¯offchainæ“ä½œï¼Œä¸ºäº†ä¿è¯æ•°æ®ä¸è¢«æ›´æ”¹ï¼Œéœ€è¦ç”¨æˆ·è¿›è¡Œç­¾åã€‚onchainæ“ä½œé€šè¿‡é“¾ä¸Šçš„accumulateHashå’Œä»¥å¤ªåŠçš„ç§é’¥çš„ç­¾åæ¥ä¿è¯ã€‚</p>
<ul>
<li>offchainwithdraw requestå•ç¬”äº¤æ˜“çš„æ•°æ®ç­¾åã€‚</li>
<li>Ordercancellation requestç­¾å</li>
<li>OrderGadget ç”¨æˆ·å¯¹è‡ªå·±è®¢å•è¿›è¡Œç­¾å</li>
</ul>
<p><strong>operatorä½¿ç”¨loopringç§é’¥ç­¾åçš„åœºæ™¯</strong></p>
<ul>
<li>operator å¯¹ringsettlementçš„publicData.publicInputå’ŒaccountBefore_O.nonceä¸¤è€…è¿›è¡ŒéªŒè¯ç­¾åï¼Œå› ä¸ºoperatorèƒ½æ“ä½œfeeå’Œrebateçš„å€¼ï¼Œå®ƒéœ€è¦ä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥æˆæƒæ”¯ä»˜çš„rebateå’Œprotocol feeã€‚</li>
</ul>
<ol start="24">
<li>onchainå’Œoffchainçš„withdrawéƒ½ä¼šåœ¨publicDataé‡Œé¢è®°å½•<code>getApprovedWithdrawalData</code>æ•°æ®ï¼Œè¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†å¾—å‡ºwithdrawamountçš„å®é™…é‡‘é¢ã€‚å› ä¸ºè®¢å•è¯·æ±‚withdrawçš„é‡‘é¢å’Œå®é™…withdrawamountçš„é‡‘é¢è¦æ ¹æ®balanceçš„å€¼æ¥å¾—å‡ºã€‚</li>
</ol>
<h3 id="å¯èƒ½é—®é¢˜">å¯èƒ½é—®é¢˜</h3>
<ol>
<li><code>offchainWithdrawalCircuit.h</code>å¯¹è´¦æˆ·è´¹ç”¨ä½™é¢å’Œè´¦æˆ·ä½™é¢ä¸¤ä¸ªè´¦æˆ·çš„å¤„ç†æœ‰ç•¥å¾®ä¸åŒã€‚<code>feePayment(pb, NUM_BITS_AMOUNT, balanceFBefore.balance, balanceBefore_O.balance, fFee.value(), FMT(prefix, &quot;.feePayment&quot;))</code>å¯¹äºè´¹ç”¨è´¦æˆ·çš„å¤„ç†ï¼Œæœ‰<code>overflow</code>çš„æ ¡éªŒï¼Œä½†æ˜¯å¯¹<code>balance_after(pb, balanceBefore.balance, amountWithdrawn.value(), FMT(prefix, &quot;.balance_after&quot;))</code>çš„å¤„ç†æ˜¯<code>UnsafeSubGadget</code>ï¼Œæ²¡æœ‰è¿›è¡Œæº¢å‡ºæ£€æµ‹çš„æ ¡éªŒã€‚å› æ­¤ç¬¬107è¡Œå·¦å³çš„<code>balance_after</code>çš„åˆå§‹åŒ–æœ‰ç–‘é—®ã€‚</li>
</ol>
<ul>
<li><strong>è§£å†³</strong>ï¼šè¿™é‡Œçš„<code>amountWithdrawn.generate_r1cs_witness(toFloat(pb.val(amountToWithdraw.result()), Float28Encoding));``amountWithdrawn</code>çš„å€¼åœ¨withnessé‡Œé¢ä½¿ç”¨ <code>amountRequested.packed</code>å’Œ<code>balanceBefore.balance</code>ä¸¤è€…ä¸­çš„æœ€å°å€¼è¿›è¡Œäº†<code>witness</code>æ­¥éª¤ï¼Œå› æ­¤åœ¨<code>balance_after</code>è¿›è¡Œåˆå§‹åŒ–çš„æ—¶å€™ä¸ä¼šåˆå§‹åŒ–æˆè´Ÿå€¼ã€‚</li>
</ul>
<ol start="2">
<li><code>onchainWithdrawalCircuit</code> ï¼Œ<code>balance_after</code>çš„åˆå§‹åŒ–ä¹Ÿæœ‰åŒæ ·é—®é¢˜ã€‚</li>
</ol>
<ul>
<li><strong>è§£å†³</strong>ï¼šè¿™é‡Œçš„è§£å†³æ–¹æ¡ˆå’Œä¸Šé¢ä¹Ÿæ˜¯ä¸€æ ·ã€‚</li>
</ul>
<ol start="3">
<li><code>MatchingGadgets.h</code>ä¸­çš„<code>CheckFillRateGadget</code>ä½¿ç”¨äº†<code>UnsafeMulGadget</code>ä¸å®‰å…¨çš„ä¹˜æ³•ï¼Œå› æ­¤åœ¨æ¯”è¾ƒä¸¤ä¸ªç»“æœçš„å¤§å°æ—¶å¯èƒ½ä¼š<code>(fillAmountS * amountB * 100) &lt; (fillAmountB * amountS * 101)</code>æº¢å‡ºã€‚å› ä¸ºäº§ç”Ÿæº¢å‡ºæ­£å¸¸æ ¡éªŒå¯èƒ½ä¼šå¼‚å¸¸ã€‚</li>
</ol>
<ul>
<li><strong>è§£å†³</strong>ï¼šå› ä¸ºè¿™é‡Œamountçš„å€¼è¢«é™åˆ¶åœ¨äº†<code>2^96-1</code>ï¼Œå› æ­¤è¿™é‡Œçš„ç›¸ä¹˜å¹¶ä¸ä¼šæº¢å‡ºã€‚</li>
</ul>
<ol start="4">
<li>RingSettlementCircuit.h<code>ç”µè·¯ä¸­çš„</code>TransformRingSettlementDataGadget<code>çš„</code>generate_r1cs_constraints`å‡½æ•°èƒ½å¤Ÿè¿›ä¸€æ­¥ä¼˜åŒ–ä¸ºä»¥ä¸‹ä»£ç ã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="k">struct</span> <span class="n">Range</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">length</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Range</span><span class="o">&gt;</span> <span class="n">ranges</span><span class="p">;</span>
<span class="n">ranges</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">});</span>   <span class="c1">// orderA.orderID + orderB.orderID
</span><span class="c1"></span><span class="n">ranges</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">});</span>  <span class="c1">// orderA.accountID + orderB.accountID
</span><span class="c1"></span><span class="n">ranges</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="mi">80</span><span class="p">,</span> <span class="mi">16</span><span class="p">});</span>  <span class="c1">// orderA.tokenS + orderB.tokenS
</span><span class="c1"></span><span class="n">ranges</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="mi">96</span><span class="p">,</span> <span class="mi">48</span><span class="p">});</span>  <span class="c1">// orderA.fillS + orderB.fillS
</span><span class="c1"></span><span class="n">ranges</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="mi">144</span><span class="p">,</span> <span class="mi">8</span><span class="p">});</span>  <span class="c1">// orderA.data
</span><span class="c1"></span><span class="n">ranges</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="mi">152</span><span class="p">,</span> <span class="mi">8</span><span class="p">});</span>  <span class="c1">// orderB.data
</span><span class="c1"></span><span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="n">Range</span><span class="o">&amp;</span> <span class="nl">subRange</span> <span class="p">:</span> <span class="n">ranges</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numRings</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">transformedData</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">subArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">ringSize</span> <span class="o">+</span> <span class="n">subRange</span><span class="p">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">subRange</span><span class="p">.</span><span class="n">length</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>å…³äº<code>MatchingGadgets</code>è¿™ä¸ªç»„ä»¶åˆ†æ</li>
</ol>
<table>
<thead>
<tr>
<th align="center">caseC</th>
<th>Taker</th>
<th>Maker</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">tokenS</td>
<td>GTO</td>
<td>WETH</td>
</tr>
<tr>
<td align="center">tokenB</td>
<td>WETH</td>
<td>GTO</td>
</tr>
<tr>
<td align="center">amountS</td>
<td>101</td>
<td>101</td>
</tr>
<tr>
<td align="center">amountB</td>
<td>100</td>
<td>100</td>
</tr>
<tr>
<td align="center">isBuy</td>
<td>Yes</td>
<td>no</td>
</tr>
<tr>
<td align="center">fill.S</td>
<td>99</td>
<td>100</td>
</tr>
<tr>
<td align="center">fill.B</td>
<td>100</td>
<td>99</td>
</tr>
<tr>
<td align="center">target price (WETH/GTO)</td>
<td>1.01</td>
<td>100/101</td>
</tr>
<tr>
<td align="center">settle price (WETH/GTO)</td>
<td>0.99</td>
<td>0.99</td>
</tr>
<tr>
<td align="center">balance tokenS</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td align="center">balance tokenB</td>
<td>100</td>
<td>99</td>
</tr>
<tr>
<td align="center">order sale price</td>
<td>100/101 W</td>
<td>100/101 G</td>
</tr>
<tr>
<td align="center">settle price</td>
<td>100/99 W</td>
<td>99/100 G</td>
</tr>
</tbody>
</table>
<p>å¯¹äºtakerï¼š<code>100/99 &gt; 100/101</code>ï¼Œå› æ­¤æˆäº¤å–å‡ºä»·æ ¼é«˜äºè®¢å•å–å‡ºä»·æ ¼ã€‚</p>
<p>å¯¹äºmaker: <code>100/101 &gt; 99/100</code>å› æ­¤å®é™…å–å‡ºä»·æ ¼æ˜¯ä½äºè®¢å•å–å‡ºä»·æ ¼ã€‚ä½†æ˜¯å…¶ä¾æ—§æ˜¯èƒ½å¤Ÿæˆäº¤ï¼Œä¾èµ–äº<code>(fillAmountS * amountB * 100) &lt; (fillAmountB * amountS * 101)</code></p>
<p>æ€»ç»“ï¼šè®¢å•åŒ¹é…æœ‰ç›Šäºtakerã€‚å…¶ä½™æƒ…å†µå‚è€ƒã€‚ <a href="https://github.com/Loopring/protocols/issues/623">link</a></p>
<ol start="6">
<li>MatchingGadgetä¸­æ³¨é‡Šå†™é”™ã€‚<code>        takerFillB_lt_makerFillS(pb, takerFill.B, makerFill.S, NUM_BITS_AMOUNT, FMT(prefix, &quot;.takerFill.B &lt; makerFill.B&quot;)),</code>åº”è¯¥ä¸º<code>&quot;.takerFill.B &lt; makerFill.S&quot;</code></li>
<li>å¯¹äºmain.cppä¸­çš„<code>prove</code>å’Œ<code>generatekeys</code>ä¸¤ä¸ªåŠ¨ä½œåŒæ—¶è¿›è¡Œå¯èƒ½å­˜åœ¨é—®é¢˜ã€‚æœ‰ä¸¤ç§é€»è¾‘ï¼šé¦–å…ˆpkå’Œvkä¸å­˜åœ¨ï¼Œåœ¨ç”Ÿæˆè¯æ˜çš„æ—¶å€™é¦–å…ˆgeneratorkeysï¼Œç„¶åå†proofï¼Œè¿™ç§æƒ…å†µé€»è¾‘ä¸Šè¯´å¾—é€šï¼Œä½†æ˜¯ä¸ç¬¦åˆå¸¸ç†ã€‚å½“pkå’Œvkä¸å­˜åœ¨æ—¶ï¼Œä¸å…è®¸æ‰§è¡Œproveæ“ä½œã€‚å› ä¸ºgeneratorkeysæ˜¯trust setupï¼Œå› æ­¤è¿™ä¸€æ­¥éª¤éœ€è¦å¤šäººå‚ä¸å¹¶ä¸”åªäº§ç”Ÿä¸€æ¬¡ã€‚å› æ­¤è¿™é‡Œæ›´å¥½é‡‡å–åé¢ä¸€ç§ä½¿ç”¨æ–¹æ³•ã€‚</li>
<li>å¯¹äºData.hæ–‡ä»¶ä¸­ï¼ŒoffchainWithdrawBlockç±»ä¸­ï¼Œ<code>startIndex</code>å’Œ<code>startHash</code>æ²¡æœ‰ä½¿ç”¨ï¼Œè²Œä¼¼ç›´æ¥ä»<code>onchainWithdrawBlock</code>ä¸­å¤åˆ¶è¿‡æ¥ğŸ˜‚ã€‚</li>
</ol>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Czm</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
      2020-04-06
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://puppym.github.io/blog/tags/loopring/">loopring</a>
          <a href="https://puppym.github.io/blog/tags/zkrollup/">zkrollup</a>
          <a href="https://puppym.github.io/blog/tags/zksnark/">zksnark</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/blog/post/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%80%9D%E8%80%83/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%80%9D%E8%80%83-web3/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">åŒºå—é“¾æ€è€ƒ-web3</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/blog/post/loopring%E4%BA%A4%E6%98%93%E6%89%80gadget%E5%88%86%E6%9E%90/loopring%E4%BA%A4%E6%98%93%E6%89%80gadget%E5%88%86%E6%9E%90/">
            <span class="next-text nav-default">Loopringäº¤æ˜“æ‰€gadgetåˆ†æ</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  


<a href="https://puppym.github.io/blog/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Czm
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/blog/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/blog/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/blog/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/blog/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/blog/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/blog/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
